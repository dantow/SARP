{"ast":null,"code":"var _jsxFileName = \"/home/rnorbert/IdeaProjects/SARP/sarp/src/components/map/mapbox/MapBox.jsx\",\n  _s = $RefreshSig$();\nimport './MapBox.css';\nimport config from '../../../config.js';\nimport mapboxgl from 'mapbox-gl';\nimport 'mapbox-gl-geocoder/dist/mapbox-gl-geocoder.css';\nimport { useEffect } from 'react';\nimport { initializeMap } from './helpers/mapInitializer';\nimport { drawRoute } from './helpers/routeDrawer';\nimport haversineDistance from '../../utils/haversine';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst token = config.mapboxToken;\nmapboxgl.accessToken = token;\nfunction MapBox() {\n  _s();\n  let placeMarker = false;\n  let routeType = 'walking';\n  let markers = [];\n  let markersToRemove = [];\n  let map;\n  let routeDetails;\n  function changeRouteType(type) {\n    routeType = type;\n  }\n  function changeMarkerPlacerState() {\n    placeMarker = !placeMarker;\n  }\n  function removeMarkers(list) {\n    list.forEach(element => {\n      element.remove();\n    });\n    markers = markers.filter(item => !list.includes(item));\n  }\n  function handleMarkerPlacement(coordinates) {\n    if (placeMarker) {\n      const maximumNumberOfMarkers = 25;\n      if (markers.length <= maximumNumberOfMarkers) {\n        markers.push(new mapboxgl.Marker().setDraggable(true).setLngLat([coordinates.lng, coordinates.lat]).addTo(map));\n      }\n    } else {\n      markersToRemove = markers.filter(marker => haversineDistance(marker.getLngLat().lat, marker.getLngLat().lng, coordinates.lat, coordinates.lng) < 30);\n      removeMarkers(markersToRemove);\n    }\n  }\n  async function retrieveDirection() {\n    try {\n      const coordinates = markers.map(marker => marker.getLngLat().lng + ',' + marker.getLngLat().lat).join(';', ',');\n      const response = await fetch(`https://api.mapbox.com/directions/v5/mapbox/${routeType}/${coordinates}\n        ?annotations=distance,duration&overview=full&geometries=geojson&access_token=${token}`);\n      routeDetails = await response.json();\n      drawRoute(await routeDetails.routes[0], map);\n    } catch (error) {\n      console.error(error);\n    }\n  }\n  function loadMap() {\n    map = initializeMap(handleMarkerPlacement);\n  }\n  useEffect(() => {\n    loadMap();\n  }, []);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"box\",\n    children: [/*#__PURE__*/_jsxDEV(\"header\", {\n      children: [/*#__PURE__*/_jsxDEV(\"meta\", {\n        name: \"viewport\",\n        content: \"initial-scale=1,maximum-scale=1,user-scalable=no\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 82,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"link\", {\n        href: \"https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.css\",\n        rel: \"stylesheet\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 83,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 81,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"settings\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            children: \"Place marker\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 88,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"checkbox\",\n            onClick: () => changeMarkerPlacerState()\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 89,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 87,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"planner\",\n          children: \"Route by:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 91,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"routes\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            children: \"Traffic\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 93,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"checkbox\",\n            onClick: () => changeRouteType('driving-traffic')\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 94,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n            children: \"Driving\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 95,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"checkbox\",\n            onClick: () => changeRouteType('driving')\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 96,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n            children: \"Walking\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 97,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"checkbox\",\n            onClick: () => changeRouteType('walking')\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 98,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n            children: \"Cycling\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 99,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"checkbox\",\n            onClick: () => changeRouteType('cycling')\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 100,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 92,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          id: \"plan-route-button\",\n          onClick: () => retrieveDirection(),\n          children: \"Plan route \"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 102,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 86,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        id: \"map\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 104,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        id: \"instructions\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 105,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 106,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 85,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 80,\n    columnNumber: 5\n  }, this);\n}\n_s(MapBox, \"OD7bBpZva5O2jO+Puf00hKivP7c=\");\n_c = MapBox;\nexport default MapBox;\nvar _c;\n$RefreshReg$(_c, \"MapBox\");","map":{"version":3,"names":["config","mapboxgl","useEffect","initializeMap","drawRoute","haversineDistance","jsxDEV","_jsxDEV","token","mapboxToken","accessToken","MapBox","_s","placeMarker","routeType","markers","markersToRemove","map","routeDetails","changeRouteType","type","changeMarkerPlacerState","removeMarkers","list","forEach","element","remove","filter","item","includes","handleMarkerPlacement","coordinates","maximumNumberOfMarkers","length","push","Marker","setDraggable","setLngLat","lng","lat","addTo","marker","getLngLat","retrieveDirection","join","response","fetch","json","routes","error","console","loadMap","className","children","name","content","fileName","_jsxFileName","lineNumber","columnNumber","href","rel","onClick","id","_c","$RefreshReg$"],"sources":["/home/rnorbert/IdeaProjects/SARP/sarp/src/components/map/mapbox/MapBox.jsx"],"sourcesContent":["import './MapBox.css'\nimport config from '../../../config.js'\nimport mapboxgl from 'mapbox-gl'\nimport 'mapbox-gl-geocoder/dist/mapbox-gl-geocoder.css'\nimport { useEffect } from 'react'\nimport { initializeMap } from './helpers/mapInitializer'\nimport { drawRoute } from './helpers/routeDrawer'\nimport haversineDistance from '../../utils/haversine'\n\nconst token = config.mapboxToken\nmapboxgl.accessToken = token\n\nfunction MapBox () {\n  let placeMarker = false\n  let routeType = 'walking'\n  let markers = []\n  let markersToRemove = []\n  let map\n  let routeDetails\n\n  function changeRouteType (type) {\n    routeType = type\n  }\n\n  function changeMarkerPlacerState () {\n    placeMarker = !placeMarker\n  }\n\n  function removeMarkers (list) {\n    list.forEach(element => {\n      element.remove()\n    })\n    markers = markers.filter(item => !list.includes(item))\n  }\n\n  function handleMarkerPlacement (coordinates) {\n    if (placeMarker) {\n      const maximumNumberOfMarkers = 25\n      if (markers.length <= maximumNumberOfMarkers) {\n        markers.push(new mapboxgl.Marker()\n          .setDraggable(true)\n          .setLngLat([coordinates.lng, coordinates.lat])\n          .addTo(map)\n        )\n      }\n    } else {\n      markersToRemove = markers.filter(marker =>\n        haversineDistance(marker.getLngLat().lat, marker.getLngLat().lng, coordinates.lat, coordinates.lng) < 30)\n\n      removeMarkers(markersToRemove)\n    }\n  }\n\n  async function retrieveDirection () {\n    try {\n      const coordinates = markers.map(\n        (marker) => marker.getLngLat().lng + ',' + marker.getLngLat().lat)\n        .join(';', ',')\n\n      const response = await fetch(\n        `https://api.mapbox.com/directions/v5/mapbox/${routeType}/${coordinates}\n        ?annotations=distance,duration&overview=full&geometries=geojson&access_token=${token}`)\n\n      routeDetails = await response.json()\n      drawRoute(await routeDetails.routes[0], map)\n    } catch (error) {\n      console.error(error)\n    }\n  }\n\n  function loadMap () {\n    map = initializeMap(handleMarkerPlacement)\n  }\n\n  useEffect(() => {\n    loadMap()\n  }, [])\n\n  return (\n    <div className='box'>\n      <header>\n        <meta name=\"viewport\" content=\"initial-scale=1,maximum-scale=1,user-scalable=no\"/>\n        <link href='https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.css' rel='stylesheet' />\n      </header>\n      <div>\n        <div className='settings'>\n          <div>\n            <label>Place marker</label>\n            <input type='checkbox' onClick={() => changeMarkerPlacerState()}/>\n          </div>\n          <div className='planner'>Route by:</div>\n          <div className='routes'>\n            <label>Traffic</label>\n            <input type='checkbox' onClick={ () => changeRouteType('driving-traffic')}/>\n            <label>Driving</label>\n            <input type='checkbox' onClick={() => changeRouteType('driving')}/>\n            <label>Walking</label>\n            <input type='checkbox' onClick={() => changeRouteType('walking')}/>\n            <label>Cycling</label>\n            <input type='checkbox' onClick={() => changeRouteType('cycling')}/>\n          </div>\n          <button id='plan-route-button' onClick={() => retrieveDirection()}>Plan route </button>\n        </div>\n        <div id=\"map\"></div>\n        <div id=\"instructions\" ></div>\n        <div>\n        </div>\n      </div>\n    </div>\n  )\n}\n\nexport default MapBox\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}